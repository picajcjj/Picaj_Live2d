(()=>{function g(e){return Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:e}function L(e){let o=document.createElement("a"),t=window.URL.createObjectURL(e);o.href=t,o.download="live2d.png",o.click(),URL.revokeObjectURL(t)}var p;function D(e,o,t){if(!e||sessionStorage.getItem("waifu-text")&&sessionStorage.getItem("waifu-text")>t)return;p&&(clearTimeout(p),p=null),e=g(e),sessionStorage.setItem("waifu-text",t);let c=document.getElementById("waifu-tips");c.innerHTML=e,c.classList.add("waifu-tips-active"),p=setTimeout(()=>{sessionStorage.removeItem("waifu-text"),c.classList.remove("waifu-tips-active")},o)}var a=D;var v=class{constructor(o){let{modelPath:t,switchType:c}=o;this.modelPath=t,this.isOrderSwitch=c==="order"}async loadModelList(){let o=await fetch(`${this.modelPath}model_list.json`);this.modelList=await o.json(),console.log()}async loadModel(o,t,c){localStorage.setItem("modelId",o),localStorage.setItem("modelTexturesId",t),this.modelList||await this.loadModelList(),a(c,4e3,10);let s=this.modelList.models[o][t];if(s===void 0){if(parseInt(o)===0&&parseInt(t)===0)return;await this.loadModel(0,0,this.modelList.messages[0][0]);return}window.live2d.loadModel(`${this.modelPath}model/`+s+"/")}async switchTextures(){let o=localStorage.getItem("modelId"),t=parseInt(localStorage.getItem("modelTexturesId"));this.modelList||await this.loadModelList();let c=this.modelList.models[o].length;if(this.isOrderSwitch)t=(t+1)%c;else{let s;do s=Math.floor(Math.random()*c);while(s===t);t=s}this.loadModel(o,t,this.modelList.messages[o][t])}async switchModel(){let o=localStorage.getItem("modelId");this.modelList||await this.loadModelList();let t=++o>=this.modelList.models.length?0:o;this.loadModel(t,0,this.modelList.messages[t][0])}},I=v;var y='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="0 0 640 640"><style>path{transition:fill 0.1s ease}svg:hover path{fill:#e0baba}</style><path fill="#ffe6e6" d="M64 416L64 192C64 139 107 96 160 96L480 96C533 96 576 139 576 192L576 416C576 469 533 512 480 512L360 512C354.8 512 349.8 513.7 345.6 516.8L230.4 603.2C226.2 606.3 221.2 608 216 608C202.7 608 192 597.3 192 584L192 512L160 512C107 512 64 469 64 416z"/></svg> ';var M='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L277.3 424.9l-40.1 74.5c-5.2 9.7-16.3 14.6-27 11.9S192 499 192 488V392c0-5.3 1.8-10.5 5.1-14.7L362.4 164.7c2.5-7.1-6.5-14.3-13-8.4L170.4 318.2l-32 28.9 0 0c-9.2 8.3-22.3 10.6-33.8 5.8l-85-35.4C8.4 312.8 .8 302.2 .1 290s5.5-23.7 16.1-29.8l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg>';var S='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M399 384.2C376.9 345.8 335.4 320 288 320H224c-47.4 0-88.9 25.8-111 64.2c35.2 39.2 86.2 63.8 143 63.8s107.8-24.7 143-63.8zM512 256c0 141.4-114.6 256-256 256S0 397.4 0 256S114.6 0 256 0S512 114.6 512 256zM256 272c39.8 0 72-32.2 72-72s-32.2-72-72-72s-72 32.2-72 72s32.2 72 72 72z"/></svg>';var x='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M320 64c0-35.3-28.7-64-64-64s-64 28.7-64 64s28.7 64 64 64s64-28.7 64-64zm-96 96c-35.3 0-64 28.7-64 64v48c0 17.7 14.3 32 32 32h1.8l11.1 99.5c1.8 16.2 15.5 28.5 31.8 28.5h38.7c16.3 0 30-12.3 31.8-28.5L318.2 304H320c17.7 0 32-14.3 32-32V224c0-35.3-28.7-64-64-64H224zM132.3 394.2c13-2.4 21.7-14.9 19.3-27.9s-14.9-21.7-27.9-19.3c-32.4 5.9-60.9 14.2-82 24.8c-10.5 5.3-20.3 11.7-27.8 19.6C6.4 399.5 0 410.5 0 424c0 21.4 15.5 36.1 29.1 45c14.7 9.6 34.3 17.3 56.4 23.4C130.2 504.7 190.4 512 256 512s125.8-7.3 170.4-19.6c22.1-6.1 41.8-13.8 56.4-23.4c13.7-8.9 29.1-23.6 29.1-45c0-13.5-6.4-24.5-14-32.6c-7.5-7.9-17.3-14.3-27.8-19.6c-21-10.6-49.5-18.9-82-24.8c-13-2.4-25.5 6.3-27.9 19.3s6.3 25.5 19.3 27.9c30.2 5.5 53.7 12.8 69 20.5c3.2 1.6 5.8 3.1 7.9 4.5c3.6 2.4 3.6 7.2 0 9.6c-8.8 5.7-23.1 11.8-43 17.3C374.3 457 318.5 464 256 464s-118.3-7-157.7-17.9c-19.9-5.5-34.2-11.6-43-17.3c-3.6-2.4-3.6-7.2 0-9.6c2.1-1.4 4.8-2.9 7.9-4.5c15.3-7.7 38.8-14.9 69-20.5z"/></svg>';var C='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="0 0 640 640"><!--!Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><style>path{transition:fill 0.1s ease}svg:hover path{fill:#e0baba}</style><path fill="#ffdcdc" d="M320 576C461.4 576 576 461.4 576 320C576 178.6 461.4 64 320 64C178.6 64 64 178.6 64 320C64 461.4 178.6 576 320 576zM229.4 385.9C249.8 413.9 282.8 432 320 432C357.2 432 390.2 413.9 410.6 385.9C418.4 375.2 433.4 372.8 444.1 380.6C454.8 388.4 457.2 403.4 449.4 414.1C420.3 454 373.2 480 320 480C266.8 480 219.7 454 190.6 414.1C182.8 403.4 185.2 388.4 195.9 380.6C206.6 372.8 221.6 375.2 229.4 385.9zM208 272C208 254.3 222.3 240 240 240C257.7 240 272 254.3 272 272C272 289.7 257.7 304 240 304C222.3 304 208 289.7 208 272zM400 240C417.7 240 432 254.3 432 272C432 289.7 417.7 304 400 304C382.3 304 368 289.7 368 272C368 254.3 382.3 240 400 240z"/></svg>';var b='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M256 512c141.4 0 256-114.6 256-256S397.4 0 256 0S0 114.6 0 256S114.6 512 256 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-144c-17.7 0-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32s-14.3 32-32 32z"/></svg>';var F='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="0 0 640 640"><!--!Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><style>path{transition:fill 0.1s ease}svg:hover path{fill:#e0baba}</style><path fill="#ffdcdc" d="M183.1 137.4C170.6 124.9 150.3 124.9 137.8 137.4C125.3 149.9 125.3 170.2 137.8 182.7L275.2 320L137.9 457.4C125.4 469.9 125.4 490.2 137.9 502.7C150.4 515.2 170.7 515.2 183.2 502.7L320.5 365.3L457.9 502.6C470.4 515.1 490.7 515.1 503.2 502.6C515.7 490.1 515.7 469.8 503.2 457.3L365.8 320L503.1 182.6C515.6 170.1 515.6 149.8 503.1 137.3C490.6 124.8 470.3 124.8 457.8 137.3L320.5 274.7L183.1 137.4z"/></svg>';var T='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M220.6 121.2L271.1 96 448 96v96H333.2c-21.9-15.1-48.5-24-77.2-24s-55.2 8.9-77.2 24H64V128H192c9.9 0 19.7-2.3 28.6-6.8zM0 128V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H271.1c-9.9 0-19.7 2.3-28.6 6.8L192 64H160V48c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16l0 16C28.7 64 0 92.7 0 128zM344 304c0 48.6-39.4 88-88 88s-88-39.4-88-88s39.4-88 88-88s88 39.4 88 88z"/></svg>';function V() {const waifuCanvas = document.getElementById("live2d");if (!waifuCanvas) return;let input = document.getElementById("waifu-chat-input");let btn = document.getElementById("waifu-chat-send");if (input && btn) {input.remove();btn.remove();return;}input = document.createElement("textarea");input.id = "waifu-chat-input";input.placeholder = "和我说点什么吧";input.style.cssText = `position:absolute;width:200px;padding:4px 6px;max-height:17.5px;resize:none;font-size:14px;border-radius:6px;border:1px solid #ccc;outline:none;z-index:101;background:rgba(255,255,255,0.9);overflow-y:scroll;scrollbar-width:none;`;document.getElementById("waifu").appendChild(input);btn = document.createElement("button");btn.id = "waifu-chat-send";btn.textContent = "发送";btn.style.cssText = `position:absolute;padding:3px 8px;font-size:13px;border:none;border-radius:6px;background:pink;color:white;cursor:pointer;z-index:101;`;document.getElementById("waifu").appendChild(btn);input.focus();function updateInputPosition() {const rect = waifuCanvas.getBoundingClientRect();const top = rect.top / 100 - 122.5;const left = rect.width / 2.25;input.style.top = `${top}px`;input.style.left = `${left}px`;input.style.transform = `translateX(-50%)`;btn.style.top = `${top}px`;btn.style.left = `${left + 110}px`;requestAnimationFrame(updateInputPosition);}updateInputPosition();async function sendMessage() {input.remove();btn.remove();const msg = input.value.trim();const tips = document.getElementById("waifu-tips");tips.classList.add("waifu-tips-active");tips.innerHTML = "";input.disabled = true;btn.disabled = true;if (!msg) {a("你的问题是什么呢?~~~", 3000, 10);tips.innerHTML = "你的问题是什么呢?~~~";return;}if (msg.length >= 150) {a("你的问题太长了，人家的脑袋处理不了这么多信息啦~~~", 3000, 10);tips.innerHTML = "你的问题太长了，人家的脑袋处理不了这么多信息啦~~~";return;}a(`你说：${msg}`, 3000, 10);tips.innerHTML = `你说：${msg}`;const oldBtn = document.getElementById("waifu-tips-copy-btn");if (oldBtn && oldBtn.parentNode) oldBtn.parentNode.removeChild(oldBtn);try {const res = await fetch("/api/ai/chat", {method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ message: msg }),});let reply = "对不起，我的大脑宕机了。呜呜呜~~~";const response = await res.json();if (response.header.code === 200) {const data = response.data;if (data && typeof data !== "boolean") {reply = data.chatResponse || reply;}} else if (response.header.code === 401) {reply = "登录账号才能和picaj聊天哦~~~";}tips.innerHTML = reply;a(reply, 20000, 10);} catch (err) {a("出错了…可能是网络问题。", 4000, 10);console.error(err);} finally {input.disabled = false;btn.disabled = false;input.value = "";input.focus();addCopyButton();}}btn.addEventListener("click", sendMessage);input.addEventListener("keydown", (e) => {if (e.key === "Enter") sendMessage();});}function addCopyButton() {const tips = document.getElementById("waifu-tips");if (!tips) return;const oldBtn = document.getElementById("waifu-tips-copy-btn");if (oldBtn && oldBtn.parentNode) oldBtn.parentNode.removeChild(oldBtn);const btn = document.createElement("button");btn.id = "waifu-tips-copy-btn";btn.textContent = "📋";btn.style.cssText = `position: fixed;width: 28px;height: 28px;font-size: 14px;border: none;border-radius: 6px;color: #fff;cursor: pointer;display: flex;align-items: center;justify-content: center;z-index: 101;transition: background-color 0.2s, opacity 0.3s;`;document.body.appendChild(btn);function updateButtonPosition() {const rect = tips.getBoundingClientRect();btn.style.top = `${rect.top + 85}px`;btn.style.left = `${rect.right - 30}px`;requestAnimationFrame(updateButtonPosition);}updateButtonPosition();const removeBtn = () => {btn.style.opacity = "0";setTimeout(() => {if (btn.parentNode) btn.parentNode.removeChild(btn);}, 300);};setTimeout(removeBtn, 19000);btn.addEventListener("click", () => {const clone = tips.cloneNode(true);const existingBtn = clone.querySelector("#waifu-tips-copy-btn");if (existingBtn) clone.removeChild(existingBtn);const text = clone.innerText.trim();navigator.clipboard.writeText(text).then(() => {btn.textContent = "OK";btn.style.backgroundColor = "rgba(0,200,100,0.8)";setTimeout(removeBtn, 1000);});});};var U={chat:{icon:y,callback:V},express:{icon:C,callback:()=>{window.live2d.randomExpression()}},"switch-model":{icon:S,callback:()=>{}},"switch-texture":{icon:x,callback:()=>{}},quit:{icon:F,callback:()=>{localStorage.setItem("waifu-display",Date.now()),a("\u613F\u4F60\u6709\u4E00\u5929\u80FD\u4E0E\u91CD\u8981\u7684\u4EBA\u91CD\u9022\u3002",2e3,11),document.getElementById("waifu").style.bottom="-500px",setTimeout(()=>{document.getElementById("waifu").style.display="none",document.getElementById("waifu-toggle").classList.add("waifu-toggle-active")},3e3)}}},u=U;function E(e){let o=new I(e);localStorage.removeItem("waifu-display"),sessionStorage.removeItem("waifu-text"),document.body.insertAdjacentHTML("beforeend",`<div id="waifu"><div id="waifu-tips"></div><canvas id="live2d" width="800" height="800"></canvas><div id="waifu-tool"></div></div>`),setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0),function(){u["switch-model"].callback=()=>o.switchModel(),u["switch-texture"].callback=()=>o.switchTextures(),Array.isArray(e.tools)||(e.tools=Object.keys(u));for(let i of e.tools)if(u[i]){let{icon:l,callback:m}=u[i];document.getElementById("waifu-tool").insertAdjacentHTML("beforeend",`<span id="waifu-tool-${i}">${l}</span>`),document.getElementById(`waifu-tool-${i}`).addEventListener("click",m)}}();function t(s){A=s;let i=!1,l,m=s.message.default;window.addEventListener("mousemove",()=>i=!0),window.addEventListener("keydown",()=>i=!0),setInterval(()=>{i?(i=!1,clearInterval(l),l=null):l||(l=setInterval(()=>{a(m,6e3,9)},2e4))},1e3),a(H(),7e3,11),window.addEventListener("mouseover",w=>{for(let{selector:d,text:n}of s.mouseover)if(w.target.closest(d)){n=g(n),n=n.replace("{text}",w.target.innerText),a(n,4e3,8);return}}),window.addEventListener("click",w=>{for(let{selector:d,text:n}of s.click)if(w.target.closest(d)){n=g(n),n=n.replace("{text}",w.target.innerText),a(n,4e3,8);return}}),s.seasons.forEach(({date:w,text:d})=>{let n=new Date,f=w.split("-")[0],r=w.split("-")[1]||f;f.split("/")[0]<=n.getMonth()+1&&n.getMonth()+1<=r.split("/")[0]&&f.split("/")[1]<=n.getDate()&&n.getDate()<=r.split("/")[1]&&(d=g(d),d=d.replace("{year}",n.getFullYear()),m.push(d))});let h=()=>{};console.log("%c",h),h.toString=()=>{a(s.message.console,6e3,9)},window.addEventListener("copy",()=>{a(s.message.copy,6e3,9)}),window.addEventListener("visibilitychange",()=>{document.hidden||a(s.message.visibilitychange,6e3,9)})}function c(){if(e.dragEnable===!1)return;let s=document.getElementById("waifu"),i=document.getElementById("live2d"),l=!1,m,h,w,d;s.onmousedown=function(f){l=!0,m=s.offsetLeft,h=f.clientX,w=s.offsetTop,d=f.clientY};let n=!e.dragDirection||e.dragDirection.length===0;window.onmousemove=function(f){if(l){if(n||e.dragDirection.includes("x")){let r=m+(f.clientX-h);r<0?r=0:r>window.innerWidth-i.clientWidth&&(r=window.innerWidth-i.clientWidth),s.style.left=r+"px"}if(n||e.dragDirection.includes("y")){let r=w+(f.clientY-d);r<30?r=30:r>window.innerHeight-i.clientHeight+10&&(r=window.innerHeight-i.clientHeight+10),s.style.top=r+"px"}}},window.onmouseup=function(f){l=!1}}(function(){let i=localStorage.getItem("modelId"),l=localStorage.getItem("modelTexturesId");i===null&&(i=0,l=0),new Promise((m,h)=>{window.live2d.init(e.modelPath+"model/"),m()}).then(()=>{o.loadModel(i,l)}),fetch(e.tipsJsonPath).then(m=>m.json()).then(t).then(c)})()}function B(e,o){typeof e=="string"&&(e={tipsJsonPath:e,apiPath:o}),k=e.homePath,document.body.insertAdjacentHTML("beforeend",`<div id="waifu-toggle"><span>\u770B\u677F\u5A18</span></div>`);let t=document.getElementById("waifu-toggle");t.addEventListener("click",()=>{t.classList.remove("waifu-toggle-active"),t.getAttribute("first-time")?(E(e),t.removeAttribute("first-time")):(localStorage.removeItem("waifu-display"),document.getElementById("waifu").style.display="",setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0))}),localStorage.getItem("waifu-display")&&Date.now()-localStorage.getItem("waifu-display")<=864e5?(t.setAttribute("first-time",!0),setTimeout(()=>{t.classList.add("waifu-toggle-active")},0)):E(e)}var A=null,k="/";function H(){if(location.pathname===k)for(let{hour:t,text:c}of A.time){let s=new Date,i=t.split("-")[0],l=t.split("-")[1]||i;if(i<=s.getHours()&&s.getHours()<=l)return c}let isBlog = location.pathname.startsWith("/blog");let siteTitle = document.title.split(" - ")[0];let e = isBlog?`\u6B22\u8FCE\u9605\u8BFB<span>\u300C${document.title.split(" - ")[0]}\u300D</span>`:`\u6B22\u8FCE\u6765\u5230<span>\u300C${document.title.split(" - ")[0]}\u300D</span>`,o;if(document.referrer!==""){let t=new URL(document.referrer),c=t.hostname.split(".")[1],s={baidu:"\u767E\u5EA6",so:"360\u641C\u7D22",google:"\u8C37\u6B4C\u641C\u7D22"};return location.hostname===t.hostname?e:(c in s?o=s[c]:o=t.hostname,`Hello\uFF01\u6765\u81EA <span>${o}</span> \u7684\u670B\u53CB<br>${e}`)}return e}function z(){a(H(),7e3,11)}window.initWidget=B;window.showWelcomeMessage=z;})();
